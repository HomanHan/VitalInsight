{"remainingRequest":"/Users/liyaodong/Documents/VitalInsight/eladmin-web/node_modules/babel-loader/lib/index.js!/Users/liyaodong/Documents/VitalInsight/eladmin-web/node_modules/eslint-loader/index.js??ref--13-0!/Users/liyaodong/Documents/VitalInsight/eladmin-web/src/router/index.js","dependencies":[{"path":"/Users/liyaodong/Documents/VitalInsight/eladmin-web/src/router/index.js","mtime":1744855950676},{"path":"/Users/liyaodong/Documents/VitalInsight/eladmin-web/babel.config.js","mtime":1744855950655},{"path":"/Users/liyaodong/Documents/VitalInsight/eladmin-web/node_modules/cache-loader/dist/cjs.js","mtime":1744860344598},{"path":"/Users/liyaodong/Documents/VitalInsight/eladmin-web/node_modules/babel-loader/lib/index.js","mtime":1744860345141},{"path":"/Users/liyaodong/Documents/VitalInsight/eladmin-web/node_modules/eslint-loader/index.js","mtime":1744860344682}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/liyaodong/Documents/VitalInsight/eladmin-web/node_modules/@babel/runtime/helpers/interopRequireDefault.js\");\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\nrequire(\"core-js/modules/web.dom.iterable\");\nrequire(\"core-js/modules/es6.object.keys\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.loadMenus = void 0;\nvar _defineProperty2 = _interopRequireDefault(require(\"/Users/liyaodong/Documents/VitalInsight/eladmin-web/node_modules/@babel/runtime-corejs2/helpers/defineProperty.js\"));\nvar _routers = _interopRequireDefault(require(\"./routers\"));\nvar _store = _interopRequireDefault(require(\"@/store\"));\nvar _settings = _interopRequireDefault(require(\"@/settings\"));\nvar _nprogress = _interopRequireDefault(require(\"nprogress\"));\nrequire(\"nprogress/nprogress.css\");\nvar _auth = require(\"@/utils/auth\");\nvar _menu = require(\"@/api/system/menu\");\nvar _permission = require(\"@/store/modules/permission\");\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; } // progress bar\n// progress bar style\n// getToken from cookie\n_nprogress.default.configure({\n  showSpinner: false\n}); // NProgress Configuration\n\nvar whiteList = ['/login']; // no redirect whitelist\n\n_routers.default.beforeEach(function (to, from, next) {\n  if (to.meta.title) {\n    document.title = to.meta.title + ' - ' + _settings.default.title;\n  }\n  _nprogress.default.start();\n  if ((0, _auth.getToken)()) {\n    // 已登录且要跳转的页面是登录页\n    if (to.path === '/login') {\n      next({\n        path: '/'\n      });\n      _nprogress.default.done();\n    } else {\n      if (_store.default.getters.roles.length === 0) {\n        // 判断当前用户是否已拉取完user_info信息\n        _store.default.dispatch('GetInfo').then(function () {\n          // 拉取user_info\n          // 动态路由，拉取菜单\n          loadMenus(next, to);\n        }).catch(function () {\n          _store.default.dispatch('LogOut').then(function () {\n            location.reload(); // 为了重新实例化vue-router对象 避免bug\n          });\n        });\n        // 登录时未拉取 菜单，在此处拉取\n      } else if (_store.default.getters.loadMenus) {\n        // 修改成false，防止死循环\n        _store.default.dispatch('updateLoadMenus');\n        loadMenus(next, to);\n      } else {\n        next();\n      }\n    }\n  } else {\n    /* has no token*/\n    if (whiteList.indexOf(to.path) !== -1) {\n      // 在免登录白名单，直接进入\n      next();\n    } else {\n      next(\"/login?redirect=\".concat(to.fullPath)); // 否则全部重定向到登录页\n      _nprogress.default.done();\n    }\n  }\n});\nvar loadMenus = exports.loadMenus = function loadMenus(next, to) {\n  (0, _menu.buildMenus)().then(function (res) {\n    var sdata = JSON.parse(JSON.stringify(res));\n    var rdata = JSON.parse(JSON.stringify(res));\n    var sidebarRoutes = (0, _permission.filterAsyncRouter)(sdata);\n    var rewriteRoutes = (0, _permission.filterAsyncRouter)(rdata, false, true);\n    rewriteRoutes.push({\n      path: '*',\n      redirect: '/404',\n      hidden: true\n    });\n    _store.default.dispatch('GenerateRoutes', rewriteRoutes).then(function () {\n      // 存储路由\n      _routers.default.addRoutes(rewriteRoutes); // 动态添加可访问路由表\n      next(_objectSpread(_objectSpread({}, to), {}, {\n        replace: true\n      }));\n    });\n    _store.default.dispatch('SetSidebarRouters', sidebarRoutes);\n  });\n};\n_routers.default.afterEach(function () {\n  _nprogress.default.done(); // finish progress bar\n});",null]}